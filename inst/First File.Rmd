---
title: "Practice with Conjoint Package"
author: "Barry DeCicco"
date: "11/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.


``` {r global-options, echo=FALSE}
# Global chunk options (over-ridden by local chunk options)
knitr::opts_chunk$set(include  = TRUE, echo = TRUE, error = TRUE, 
                      message = FALSE, warning = TRUE, fig.width=14, fig.height=10)

# Declare path to this script relative to the project root directory.
here::i_am(
  path = "inst/Practice with Conjoint Package.Rmd"
  )

# Suppress scientific notation:

# From:  https://stat.ethz.ch/R-manual/R-devel/library/base/html/options.html

options(scipen = 5)


```

## Next we load R packages required for this script to work. 

```{r load-packages, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}

library(emmeans)    # for emmeans
library(lme4) 
library(flextable)  # for tables with .rtf output
library(psych)      # for ICC
library(magrittr)
library(rmarkdown)  # For pandoc_version()
library(Hmisc)      # for label()
library(here)       # for here()
library(devtools)   # for session_info()
# library(TFCBTLS)    # for git_report()

library(kableExtra) # for pretty tables
library(tidyquant)  # for date conversions - zoo()

library(pastecs)    # for stat.desc
library(tidyverse)

library(readxl)     # For reading in .xlsx and .xsl files, without using Java.
# library(xlsx)       # to import from Excel (cohort dates)


library(janitor)    # for the tabyl command  (nice tables)

library(stringr)    # string work, such as st_detect()

require(gridExtra)  # for printing a grid of plots.

library(broom)      # both of these are for getting nice output
library("tidyr")    # from linear mixed models.

library(radiant)    # For stting up designeex 
```

# Background:

This file is to experiment with the **conjoint** package in R.  This is based on matierals in **R for marketing students** (https://bookdown.org/content/6ef13ea6-4e86-4566-b665-ebcd19d45029/)


# Import and Process Data: 

## Import data:
```{r import-from-xlsx, echo=FALSE, include=FALSE}

icecream <- readxl::read_xlsx(here('inst/extdata/icecream.xlsx'),1)

View(icecream)

```

## Process the data

Convert it from one column per respondent to one row per rating.  This will have many rows per respondent, one for each profile for which they gave a rating.

In general, this is called going from 'wide' to 'long'.

```{r import-from-xlsx, echo=FALSE, include=FALSE}

icecream <- icecream %>% 
  pivot_longer(cols = starts_with("Individual"), names_to = "respondent", values_to = "rating") %>% # respondent keeps track of the respondent, rating will store the respondent's ratings, and we want to stack every variable that starts with Individual
  rename("profile" = "Observations") %>% # rename Observations to profile
  mutate(profile = factor(profile), respondent = factor(respondent),  # factorize identifiers
         Flavor = factor(Flavor), Packaging = factor(Packaging), Light = factor(Light), Organic = factor(Organic)) # factorize the ice cream attributes


View(icecream)

```


